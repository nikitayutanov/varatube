import { getProgramMetadata } from '@gear-js/api';
import { useReadFullState } from '@gear-js/react-hooks';
import { HexString } from '@polkadot/util/types';

const metaHex =
  '0x010000000000010500000000000000000001080000009d093800000004080410000410106773746418636f6d6d6f6e287072696d6974697665731c4163746f724964000004000801205b75383b2033325d000008000003200000000c000c0000050300100000050700140850676561725f737562736372697074696f6e5f696f1c416374696f6e73000108505265676973746572537562736372697074696f6e0c01387061796d656e745f6d6574686f6404011c4163746f724964000118706572696f64180118506572696f64000130776974685f72656e6577616c1c0110626f6f6c00000044436865636b537562736372697074696f6e0401287375627363726962657204011c4163746f72496400010000180850676561725f737562736372697074696f6e5f696f18506572696f64000118144d6f6e74680000002c54687265654d6f6e746873000100245369784d6f6e746873000200284e696e654d6f6e74687300030010596561720004002854686972747953656373000500001c0000050000200850676561725f737562736372697074696f6e5f696f44537562736372697074696f6e5374617465000004012c737562736372696265727324018442547265654d61703c4163746f7249642c2053756273637269626572446174613e000024042042547265654d617008044b01040456012800040030000000280850676561725f737562736372697074696f6e5f696f38537562736372696265724461746100000c0130776974685f72656e6577616c1c0110626f6f6c000124656e645f626c6f636b2c010c7533320001387061796d656e745f6d6574686f6404011c4163746f72496400002c00000505003000000234003400000408042800' as HexString;

const programId = '0xeb6caf9943caafc5272aca4eaa3b865aaa6c2118819318c36f182497c8ff655d' as HexString;

const metadata = getProgramMetadata(metaHex);

type FullState = {
  subscribers: {
    [key: HexString]: {
      withRenewal: boolean;
      endBlock: number;
      paymentMethod: HexString;
    };
  };
};

function useSubscriptions() {
  const { state, isStateRead } = useReadFullState<FullState>(programId, metadata);

  return { subscriptionsState: state?.subscribers, isSubscriptionsStateRead: isStateRead };
}

export { useSubscriptions };
